<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8" />
    <!-- 
    <meta
      http-equiv="Content-Security-Policy"
      content="default-src 'self'; script-src 'self'"
    />
    <meta
      http-equiv="X-Content-Security-Policy"
      content="default-src 'self'; script-src 'self'"
    />
    sidebar code -->
    <title>Focus Mind</title>
    <!-- Using Boxivons because they have more veriety -->
    <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-..."> -->
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <script src="https://kit.fontawesome.com/b81fdd1146.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/floating-button.css">
    <link rel="stylesheet" href="../css/frame.css">
    <link rel="stylesheet" href="../css/loading-animation.css">
    <link rel="stylesheet" href="../css/dashboard.css">
    <link rel="stylesheet" href="../css/congrats-modal.css">
    <link rel="stylesheet" href="../css/settings.css">
    <link rel="stylesheet" href="../css/sidebar.css">

    <!--bootstrap-->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>

<body>
    <div id="title-bar">
        <div id="title" style="padding-left: 5px;">Focus Mind</div>
        <div id="buttons">
            <div id="minimize-btn">&#x2500;</div>
            <div id="close-btn">&#x2715;</div>
        </div>
    </div>
    <!-- sidebar code -->

    <nav class="sidebar close" style="margin-top: 45px; background-color: #FEF6EB;">
        <header>
            <div class="image-text">
                <span class="image">
                    <img src="../images/focus mind.png" alt="logo" />
                </span>

                <div class="text header-text">
                    <span class="name">FocusMind</span>
                </div>
            </div>

            <i class='bx bx-chevron-right toggle'></i>
        </header>

        <div class="menu-bar">
            <div class="menu">
                <ul class="menu-links">
                    <li class="nav-links">
                        <a href="../index.html">
                            <i class='bx bx-list-ul icon'></i>
                            <span class="text nav-text">Overview</span>
                        </a>
                    </li>
                    <li class="nav-links">
                        <a href="./Analytics.html">
                            <i class='bx bxs-bar-chart-alt-2 icon'></i>
                            <span class="text nav-text">Analytics</span>
                        </a>
                    </li>
                    <li class="nav-links">
                        <a href="./focus.html">
                            <i class='bx bx-crosshair icon'></i>
                            <span class="text nav-text">Focus</span>
                        </a>
                    </li>
                    <li class="nav-links">
                        <a href="./calender.html">
                            <i class='bx bx-calendar-event icon'></i>
                            <span class="text nav-text">Calender</span>
                        </a>
                    </li>
                    <li class="nav-links">
                        <a href="#">
                            <i class='bx bx-cog icon'></i>
                            <span class="text nav-text">Settings</span>
                        </a>
                    </li>
                </ul>
            </div>
        </div>

        <div class="bottom-content">
            <div class="toggle-switch">
                <span class="switch"></span>
            </div>
        </div>

    </nav>


    <section class="home" style="overflow: scroll;">

        <!-- main app -->

        <div class="text">

            <div class="settings-container">
                <div class="settings-title">Settings</div>
                <div class="settings-dropdown" style="margin-right: 20px;">
                    <div class="input-group mb-3">
                        <select class="form-control" id="websiteDropdown">
                            <option value="option1">Student</option>
                            <option value="option2">Teacher</option>
                            <option value="option3">Parent</option>
                            <option value="option4">Employee</option>
                            <option value="option5">Option 5</option>
                        </select>
                    </div>
                </div>
            </div>

            <hr>
            <div class="container-fluid">

                <div class="row">
                    <div class="col-md-6">
                        <div class="card block-card">
                            <h5 class="card-header blocked-card-head">Blocked Applications</h5>
                            <div class="card-body blocked-card-body">
                                <div class="input-group mb-3">
                                    <input type="text" class="form-control" id="txtAddApp"
                                        placeholder="Block more applications by entering there name"
                                        style="width: 80%;">
                                    <div class="input-group-append" style="width: 20%;">
                                        <button class="btn green-button" type="button"
                                            onclick="appendContentToFile(document.getElementById('txtAddApp').value)">Add</button>
                                    </div>
                                </div>
                                <div class="text-container">
                                    <table id="blockedAppsTable">
                                        <tbody></tbody>
                                    </table>
                                </div>

                            </div>
                            <!-- Hiding import export
                            <div class="card-footer blocked-card-footer float-right">
                                <div class="contaier-fluid">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <a href="#" class="btn imp-exp-btn green-button">
                                                <i class="fas fa-file-import" id="exprtApps"></i> Import
                                            </a>
                                        </div>
                                        <div class="col-md-6">
                                            <a href="#" class="btn imp-exp-btn"
                                                style="background-color: #a76464; color: white;">
                                                <i class="fas fa-file-export"></i> Export
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            -->
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card block-card">

                            <h5 class="card-header blocked-card-head">Blocked Websites</h5>
                            <div class="card-body blocked-card-body">
                                <div class="input-group mb-3">
                                    <input type="text" class="form-control"
                                        placeholder="Block more applications by entering there name"
                                        style="width: 80%;">
                                    <div class="input-group-append" style="width: 20%;">
                                        <button class="btn green-button" type="button">Add</button>
                                    </div>
                                </div>
                                <div class="text-container" style="overflow: hidden;">
                                    <p class="mb-0 text-center h3    mt-5">Coming Soon!</p>
                                </div>
                            </div>
                            <!-- Hiding import export
                            <div class="card-footer blocked-card-footer float-right">
                                <div class="contaier-fluid">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <a href="#" class="btn imp-exp-btn green-button">
                                                <i class="fas fa-file-import"></i> Import
                                            </a>
                                        </div>
                                        <div class="col-md-6">
                                            <a href="#" class="btn imp-exp-btn"
                                                style="background-color: #a76464; color: white;">
                                                <i class="fas fa-file-export"></i> Export
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        -->
                        </div>
                    </div>
                    <div class="col-md-1">
                    </div>
                </div>
            </div>
        </div>
        <div class="container-fluid">
            <div class="row justify-content-center">
                <div class="col-12 col-lg-10 col-xl-8 mx-auto">

                    <div class="my-4 untext">
                        <strong class="mb-0">Blackout Mode</strong>
                        <p>Blackout mode is an essential feature to maintain work/life balance.</p>

                        <div class="list-group mb-5 shadow">
                            <div class="list-group-item">
                                <div class="row align-items-center">
                                    <div class="col">
                                        <strong class="mb-0">Blackout Mode Timer</strong>
                                        <p class="text-muted mb-0">How often should Blackout mode be activated during
                                            focusing</p>
                                    </div>
                                    <div class="col-auto">
                                        <div class="form-outline">
                                            <button id="decreaseTimer" class="btn btn-secondary">-</button>
                                            <div style="display: inline-flex; align-items: center;">
                                                <input type="number" id="timerValue" value="" min="1"
                                                    class="form-control" style="width: 80px; text-align: right;" readonly>
                                                <span id="timerUnit" style="margin-left: 5px;">min</span>
                                            </div>
                                            <button id="increaseTimer" class="btn btn-secondary">+</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="list-group-item">
                                <div class="row align-items-center">
                                    <div class="col">
                                        <strong class="mb-0">Blackout Mode Duration</strong>
                                        <p class="text-muted mb-0">How long should Blackout mode be activated for</p>
                                    </div>
                                    <div class="col-auto">
                                        <div class="form-outline">
                                            <select id="Duration" class="form-control" style="width: 100px;">
                                                <option value="1">1</option>
                                                <option value="2">2</option>
                                                <option value="3">3</option>
                                                <option value="4">4</option>
                                                <option value="5">5</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="list-group-item">
                                <div class="row align-items-center">
                                    <div class="col">
                                        <strong class="mb-0">Allow Early Blackout Mode Deactivation</strong>
                                        <p class="text-muted mb-0">Should there be an option to disable leave Blackout
                                            mode early</p>
                                    </div>
                                    <div class="col-auto">
                                        <div class="custom-control custom-switch">
                                            <input type="checkbox" class="custom-control-input"
                                                id="earlyBlackoutDeactivation" checked>
                                            <label class="custom-control-label" for="earlyBlackoutDeactivation"></label>
                                        </div>

                                    </div>
                                </div>
                            </div>
                            <div class="list-group-item">
                                <div class="row align-items-center">
                                    <div class="col">
                                        <strong class="mb-0">Disable Keyboard</strong>
                                        <p class="text-muted mb-0">Disable keyboard while blackout mode is active</p>
                                    </div>
                                    <div class="col-auto">
                                        <div class="custom-control custom-switch">
                                            <span class="text-muted mb-0">Coming Soon!</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="list-group-item">
                                <div class="row align-items-center">
                                    <div class="col">
                                        <strong class="mb-0">Multi Screen Blackout</strong>
                                        <p class="text-muted mb-0">MultiScreen Blackout which will deactivate every
                                            screen</p>
                                    </div>
                                    <div class="col-auto">
                                        <div class="custom-control custom-switch">
                                            <span class="text-muted mb-0">Coming Soon!</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <hr class="my-4" />
                        <strong class="mb-0">Notification Blocking</strong>
                        <p>Please enable system alert you will get.</p>
                        <div class="list-group mb-5 shadow">
                            <div class="list-group-item">
                                <div class="row align-items-center">
                                    <div class="col">
                                        <strong class="mb-0">Allow Notification Blocking</strong>
                                        <p class="text-muted mb-0"></p>
                                    </div>
                                    <div class="col-auto">
                                        <!-- <div class="custom-control custom-switch">
                                            <input type="checkbox" class="custom-control-input" id="alert3"
                                                checked="" />
                                            <span class="custom-control-label"></span>
                                        </div> -->
                                        <div class="custom-control custom-switch">
                                            <input type="checkbox" class="custom-control-input"
                                                id="allowNotificationBlocking" checked>
                                            <label class="custom-control-label" for="allowNotificationBlocking"></label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="list-group-item">
                                <div class="row align-items-center">
                                    <div class="col">
                                        <strong class="mb-0">Provide all the notifications after focus mode is
                                            deactivated</strong>
                                        <p class="text-muted mb-0">Saves all the Notifications in a database and
                                            displays it to user
                                            after finishing a focus mode cycle, Notifications are never stored and
                                            deleted after user sees them
                                        </p>
                                    </div>
                                    <div class="col-auto">
                                        <div class="custom-control custom-switch">
                                            <span class="text-muted mb-0">Coming Soon!</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <hr class="my-4" />
                        <!--
                        <strong class="mb-0">Analytics</strong>
                        <p>Sunt occaecat ullamco ipsum tempor.</p>
                        <div class="list-group mb-5 shadow">
                            <div class="list-group-item">
                                <div class="row align-items-center">
                                    <div class="col">
                                        <strong class="mb-0">Lorem Ipsum Dolor Sit Amet</strong>
                                        <p class="text-muted mb-0">Do laboris nostrud qui consectetur laborum non.</p>
                                    </div>
                                    <div class="col-auto">
                                        <div class="custom-control custom-switch">
                                            <input type="checkbox" class="custom-control-input" id="alert3"
                                                checked="" />
                                            <span class="custom-control-label"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="list-group-item">
                                <div class="row align-items-center">
                                    <div class="col">
                                        <strong class="mb-0">Do consequat minim duis incididunt eiusmod nisi voluptate
                                            quis exercitation magna enim et.</strong>
                                        <p class="text-muted mb-0">Enim est ea commodo ex laborum laborum adipisicing
                                            deserunt
                                            labore laboris laboris sit id. Eu amet officia non non.
                                            Est ad laboris veniam voluptate pariatur culpa adipisicing esse nulla
                                            excepteur cupidatat elit fugiat Lorem. In deserunt dolor consectetur
                                            reprehenderit nostrud aute nostrud non voluptate officia adipisicing id.
                                        </p>
                                    </div>
                                    <div class="col-auto">
                                        <div class="custom-control custom-switch">
                                            <input type="checkbox" class="custom-control-input" id="alert4"
                                                checked="" />
                                            <span class="custom-control-label"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        -->
                    </div>
                </div>
            </div>
        </div>

        </div>

    </section>


    <!-- Insert this line above script imports, required for electron node integration  -->
    <script>if (typeof module === 'object') { window.module = module; module = undefined; }</script>


    <!-- Bootstrap JS and dependencies -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <!-- Code for other js files-->
    <script src="../js/crud.js"></script>
    <script src="../js/renderer.js"></script>

    <!-- Insert this line after script imports -->
    <script>if (window.module) module = window.module;</script>

    <div id="preloader">
    </div>
    <!-- CRUD for tables -->
    <script>

        // Function to fetch blocked applications from the text file
        async function fetchBlockedApplications() {
            try {
                const response = await fetch('../database/apps.txt');
                const data = await response.text();
                return data.split('\n').filter(app => app.trim() !== '');
            } catch (error) {
                console.error('Error fetching blocked applications:', error);
                return [];
            }
        }

        // Function to render blocked applications in the table
        async function renderBlockedApplications() {
            const blockedApps = await fetchBlockedApplications();
            const tableBody = document.querySelector('#blockedAppsTable tbody');

            // Clear existing rows
            tableBody.innerHTML = '';

            // Add rows for each application
            blockedApps.forEach(app => {
                const row = document.createElement('tr');
                row.innerHTML = `
                <td>${app}</td>
                <td><button class="remove-button" onclick="removeLineContaining('${app}','database/apps.txt')">-</button></td>
            `;
                tableBody.appendChild(row);
            });
        }
        const fs = require('fs');
        // Function to remove an application from the list and also remove it from
        // the text file
        function removeLineContaining(name, filePath) {
            let fileContent = fs.readFileSync(filePath, 'utf8');
            let lines = fileContent.split('\n');
            let index = lines.findIndex(line => line.toLowerCase().includes(name.toLowerCase()));

            if (index !== -1) {
                // Remove the line if found
                lines.splice(index, 1);

                // Join the remaining lines back into a single string
                fileContent = lines.join('\n');

                // Write the updated content back to the file
                fs.writeFileSync(filePath, fileContent);

                console.log(`Line containing '${name}' removed from file.`);
                renderBlockedApplications();
            } else {
                console.log(`No line containing '${name}' found in file.`);
            }
        }

        function appendContentToFile(content) {
            // Check if content is empty or consists only of whitespace
            if (!content.trim()) {
                console.log('Content is empty. Nothing to append.');
                return;
            }

            // Split the content by comma and join with newline to get the desired format
            const formattedContent = content.split(',').join('\n');

            // Append the content to the file
            fs.appendFile('database/apps.txt', '\n' + formattedContent, function (err) {
                if (err) throw err;
                console.log('Saved!');
                renderBlockedApplications(); // Assuming renderBlockedApplications is defined elsewhere
            });
        }

        // Initial rendering of blocked applications
        renderBlockedApplications();
    </script>

    <!--Loading database-->
    <script>
        <!-- Code for Increase and Decrease-->
        document.addEventListener("DOMContentLoaded", function () {
            const increaseButton = document.getElementById("increaseTimer");
            const decreaseButton = document.getElementById("decreaseTimer");
            const timerValueInput = document.getElementById("timerValue");

            increaseButton.addEventListener("click", function () {
                const currentValue = parseInt(timerValueInput.value, 10);
                timerValueInput.value = currentValue + 1; // Increase by 1 minute
                changeTimerValue(timerValueInput.value * 60000); // Convert to milliseconds when sending to the backend
            });

            decreaseButton.addEventListener("click", function () {
                const currentValue = parseInt(timerValueInput.value, 10);
                if (currentValue > 1) {
                    timerValueInput.value = currentValue - 1; // Decrease by 1 minute
                    changeTimerValue(timerValueInput.value * 60000); // Convert to milliseconds when sending to the backend
                }
            });
        });
    </script>
    <script>
        //read
        fetch('../database/settings.json')
            .then(response => response.json())
            .then(data => {
                // Update the content of the span element with the timerSetting value
                document.getElementById('timerValue').value = data.BlackoutModeSettings.Timer / 60000; // Convert to minutes

                document.getElementById('Duration').value = data.BlackoutModeSettings.Duration;
                // Update the checked state of the earlyBlackoutDeactivation checkbox
                const earlyBlackoutDeactivationCheckbox = document.getElementById('earlyBlackoutDeactivation');
                earlyBlackoutDeactivationCheckbox.checked = data.BlackoutModeSettings.QuitEarly;

                const allowNotificationBlockingCheckbox = document.getElementById('allowNotificationBlocking');
                allowNotificationBlockingCheckbox.checked = data.NotificationBlocking.NotificationEnable;
            })
            .catch(error => {
                console.error('Error fetching or parsing JSON:', error);
            });
    </script>

    <script>
        function applyBlackoutSettings() {
            // Get the numeric value from the input
            var blackoutDuration = document.getElementById('blackoutTimerInput').value;

            // Convert the value to a number, in case it's needed
            blackoutDuration = Number(blackoutDuration);

            // Here, use blackoutDuration wherever you need to apply the blackout timer setting
            // For example, saving to a settings object or directly applying to a timer function
            console.log('Blackout Duration Set To:', blackoutDuration);

            // If you're saving this to a JSON file or elsewhere, include that logic here
        }

        //document.getElementById('saveSettingsButton').addEventListener('click', applyBlackoutSettings);
        document.getElementById("Duration").addEventListener("change", function () {
            // Call your function here
            val = document.getElementById('Duration').value = this.value;
            changeDuration(val);
        });

        function changeDuration(value) {
            const data = JSON.parse(fs.readFileSync('database/settings.json', 'utf8'));
            var Duration = data.BlackoutModeSettings.Duration;
            fs.readFile('database/settings.json', 'utf8', (err, data) => {
                if (err) {
                    console.error('Error reading JSON file:', err);
                    return;
                }
                try {
                    // Parse the JSON data
                    const analytics = JSON.parse(data);

                    // Modify the value (for example, incrementing BlackoutTimer)
                    analytics.BlackoutModeSettings.Duration = value;

                    // Convert the modified object back to JSON format
                    const updatedData = JSON.stringify(analytics, null, 2);

                    // Write the updated JSON back to the file
                    fs.writeFile('database/settings.json', updatedData, 'utf8', (err) => {
                        if (err) {
                            console.error('Error writing JSON file:', err);
                            return;
                        }
                        console.log('JSON file updated successfully.');
                    });
                } catch (error) {
                    console.error('Error parsing JSON:', error);
                }
            });
        }

        document.getElementById("timerValue").addEventListener("change", function () {
            // Call your function here
            var val = document.getElementById('timerValue').value;
            changeTimerValue(val);
        });

        function changeTimerValue(value) {
            const fs = require('fs'); // Import the file system module
            fs.readFile('database/settings.json', 'utf8', (err, data) => {
                if (err) {
                    console.error('Error reading JSON file:', err);
                    return;
                }
                try {
                    // Parse the JSON data
                    const analytics = JSON.parse(data);

                    // Modify the value (for example, changing Timer value)
                    analytics.BlackoutModeSettings.Timer = value;

                    // Convert the modified object back to JSON format
                    const updatedData = JSON.stringify(analytics, null, 2);

                    // Write the updated JSON back to the file
                    fs.writeFile('database/settings.json', updatedData, 'utf8', (err) => {
                        if (err) {
                            console.error('Error writing JSON file:', err);
                            return;
                        }
                        console.log('JSON file updated successfully.');
                    });
                } catch (error) {
                    console.error('Error parsing JSON:', error);
                }
            });
        }

        document.addEventListener("DOMContentLoaded", function () {
            const earlyBlackoutDeactivationCheckbox = document.getElementById("earlyBlackoutDeactivation");

            // Add event listener for checkbox change
            earlyBlackoutDeactivationCheckbox.addEventListener("change", function () {
                const isChecked = this.checked;
                changeQuitEarlySetting(isChecked);
            });
        });

        function changeQuitEarlySetting(value) {
            const fs = require('fs'); // Import the file system module
            fs.readFile('database/settings.json', 'utf8', (err, data) => {
                if (err) {
                    console.error('Error reading JSON file:', err);
                    return;
                }
                try {
                    // Parse the JSON data
                    const analytics = JSON.parse(data);

                    // Modify the value (for example, changing QuitEarly setting)
                    analytics.BlackoutModeSettings.QuitEarly = value;

                    // Convert the modified object back to JSON format
                    const updatedData = JSON.stringify(analytics, null, 2);

                    // Write the updated JSON back to the file
                    fs.writeFile('database/settings.json', updatedData, 'utf8', (err) => {
                        if (err) {
                            console.error('Error writing JSON file:', err);
                            return;
                        }
                        console.log('JSON file updated successfully.');
                    });
                } catch (error) {
                    console.error('Error parsing JSON:', error);
                }
            });
        }

        document.addEventListener("DOMContentLoaded", function () {
            const allowNotificationBlockingCheckbox = document.getElementById("allowNotificationBlocking");

            // Add event listener for checkbox change
            allowNotificationBlockingCheckbox.addEventListener("change", function () {
                const isChecked = this.checked;
                changeNotificationEnableSetting(isChecked);
            });
        });

        function changeNotificationEnableSetting(value) {
            const fs = require('fs'); // Import the file system module
            fs.readFile('database/settings.json', 'utf8', (err, data) => {
                if (err) {
                    console.error('Error reading JSON file:', err);
                    return;
                }
                try {
                    // Parse the JSON data
                    const settings = JSON.parse(data);

                    // Modify the value (for example, changing NotificationEnable setting)
                    settings.NotificationBlocking.NotificationEnable = value;

                    // Convert the modified object back to JSON format
                    const updatedData = JSON.stringify(settings, null, 2);

                    // Write the updated JSON back to the file
                    fs.writeFile('database/settings.json', updatedData, 'utf8', (err) => {
                        if (err) {
                            console.error('Error writing JSON file:', err);
                            return;
                        }
                        console.log('JSON file updated successfully.');
                    });
                } catch (error) {
                    console.error('Error parsing JSON:', error);
                }
            });
        }


    </script>


    <!-- Pre loader Script
    <script>
    var loader = document.getElementById("preloader");
      window.addEventListener("load", function(){
       loader.style.display = "none";
     });
    </script> 
  -->
</body>

</html>