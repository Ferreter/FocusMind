<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8" />
    <!-- 
    <meta
      http-equiv="Content-Security-Policy"
      content="default-src 'self'; script-src 'self'"
    />
    <meta
      http-equiv="X-Content-Security-Policy"
      content="default-src 'self'; script-src 'self'"
    />
    sidebar code -->
    <title>Focus Mind</title>
    <!-- Using Boxivons because they have more veriety -->
    <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-..."> -->
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <script src="https://kit.fontawesome.com/b81fdd1146.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="../css/graphs.css">
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/floating-button.css">
    <link rel="stylesheet" href="../css/frame.css">
    <link rel="stylesheet" href="../css/loading-animation.css">
    <link rel="stylesheet" href="../css/dashboard.css">
    <link rel="stylesheet" href="../css/congrats-modal.css">
    <link rel="stylesheet" href="../css/settings.css">
    <link rel="stylesheet" href="../css/sidebar.css">

    <!--bootstrap-->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>

<body>
    <div id="title-bar">
        <div id="title" style="padding-left: 5px;">Focus Mind</div>
        <div id="buttons">
            <div id="minimize-btn">&#x2500;</div>
            <div id="close-btn">&#x2715;</div>
        </div>
    </div>
    <!-- sidebar code -->

    <nav class="sidebar close" style="margin-top: 45px; background-color: #FEF6EB;">
        <header>
            <div class="image-text">
                <span class="image">
                    <img src="../images/focus mind.png" alt="logo" />
                </span>

                <div class="text header-text">
                    <span class="name">FocusMind</span>
                </div>
            </div>

            <i class='bx bx-chevron-right toggle'></i>
        </header>

        <div class="menu-bar">
            <div class="menu">
                <ul class="menu-links">
                    <li class="nav-links">
                        <a href="../index.html">
                            <i class='bx bx-list-ul icon'></i>
                            <span class="text nav-text">Overview</span>
                        </a>
                    </li>
                    <li class="nav-links">
                        <a href="#">
                            <i class='bx bxs-bar-chart-alt-2 icon'></i>
                            <span class="text nav-text">Analytics</span>
                        </a>
                    </li>
                    <li class="nav-links">
                        <a href="./focus.html">
                            <i class='bx bx-crosshair icon'></i>
                            <span class="text nav-text">Focus</span>
                        </a>
                    </li>
                    <li class="nav-links">
                        <a href="./calender.html">
                            <i class='bx bx-calendar-event icon'></i>
                            <span class="text nav-text">Calender</span>
                        </a>
                    </li>
                    <li class="nav-links">
                        <a href="./settings.html">
                            <i class='bx bx-cog icon'></i>
                            <span class="text nav-text">Settings</span>
                        </a>
                    </li>
                </ul>
            </div>
        </div>

        <div class="bottom-content">
            <div class="toggle-switch">
                <span class="switch"></span>
            </div>
        </div>

    </nav>


    <section class="home" style="overflow: scroll;">




        <div class="text">
            Time Spent
            <hr>

            <!-- Add Cards -->
            <div class="text">
                Overview
            </div>
            <div class="cardBox">

                <div class="card">
                    <div>
                        <div class="numbers">7</div>
                        <div class="cardName">Hours Focused</div>
                    </div>
                    <div class="iconBox">
                        <ion-icon name="library-outline"></ion-icon>
                    </div>
                </div>
                <!-- <div class="card">
                    <div>
                        <div class="numbers">2</div>
                        <div class="cardName">Hours Rested</div>
                    </div>
                    <div class="iconBox">
                        <ion-icon name="barbell-outline"></ion-icon>
                    </div>
                </div> -->
                <!-- <div class="card">
                    <div>
                        <div class="numbers">7</div>
                        <div class="cardName">Total Apps Closed</div>
                    </div>
                    <div class="iconBox">
                        <ion-icon name="close-circle-outline"></ion-icon>
                    </div>
                </div> -->
                <div class="card">
                    <div>
                        <div class="numbers">7</div>
                        <div class="cardName">Average Blackout Mode Duration</div>
                    </div>
                    <div class="iconBox">
                        <ion-icon name="brush-outline"></ion-icon>
                    </div>
                </div>
            </div>
            <div class="cardBox">
                <div class="card">
                    <div>
                        <div class="numbers" id="lastWeekFocusDuration">0</div>
                        <div class="cardName">Minutes focused this week</div>
                    </div>
                    <div class="iconBox">
                        <i class="far fa-clock"></i>
                    </div>
                </div>
                <div class="card">
                    <div>
                        <div class="numbers" id="thisMonthFocusDuration">0</div>
                        <div class="cardName">Minutes focused this month</div>
                    </div>
                    <div class="iconBox">
                        <i class="far fa-clock"></i>
                    </div>
                </div>
            </div>

            <!-- Apps Closed While Focusing This Week -->
            <div class="text">
                Distractions Eliminiated
                <hr>
            </div>
            <div class="cardBox">
                <div class="card">
                    <div>
                        <div class="numbers" id="appsClosedThisWeek">0</div>
                        <div class="cardName">Times this week</div>
                    </div>
                    <div class="iconBox">
                        <i class="far fa-window-close"></i>
                    </div>
                </div>
                <div class="card">
                    <div>
                        <div class="numbers" id="appsClosedThisMonth">0</div>
                        <div class="cardName">Times this month</div>
                    </div>
                    <div class="iconBox">
                        <i class="far fa-window-close"></i>
                    </div>
                </div>
            </div>
            <!-- Betterment from Last Week -->
            <div class="text">
                Betterment from Last Week
                <hr>
            </div>
            <div class="cardBox">
                <div class="card">
                    <div>
                        <div class="numbers" id="bettermentFromLastWeek">0%</div>
                        <div class="cardName">Improvement</div>
                    </div>
                    <div class="iconBox">
                        <i class="fas fa-chart-line"></i>
                    </div>
                </div>
            </div>
            <!-- Adding Charts -->
            <div class="text">
                Indepth Analysis
            </div>
            <div class="graphBox">
                <div class="box">
                    <canvas id="myChart"></canvas>
                </div>
                <div class="box">
                    <canvas id="focusMode"></canvas>
                </div>
            </div>

            <!-- Additional Section for Mood Analytics -->
            <div class="text">Mood Analytics</div>
            <div class="cardBoxMood">
                <!-- Mood Entries Overview -->
                <div class="card">
                    <div>
                        <div class="numbers" id="moodCountHappy">1</div>
                    </div>
                    <div class="iconBox">
                        <i class="far fa-tired"></i>
                    </div>
                </div>
                <div class="card">
                    <div>
                        <div class="numbers" id="moodCountTired">1</div>
                    </div>
                    <div class="iconBox">
                        <i class="fa-regular fa-face-frown"></i>
                    </div>
                </div>
                <div class="card">
                    <div>
                        <div class="numbers" id="moodCountTired">1</div>
                    </div>
                    <div class="iconBox">
                        <i class="fa-regular fa-face-meh"></i>
                    </div>
                </div>
                <div class="card">
                    <div>
                        <div class="numbers" id="moodCountTired">1</div>
                    </div>
                    <div class="iconBox">
                        <i class="fa-regular fa-face-smile"></i>
                    </div>
                </div>
                <div class="card">
                    <div>
                        <div class="numbers" id="moodCountTired">1</div>
                    </div>
                    <div class="iconBox">
                        <i class="fa-regular fa-face-laugh-beam"></i>
                    </div>
                </div>
            </div>

            <!-- Mood Entries Detail List -->
            <div class="detailBox">
                <div class="text">Detailed Mood Entries</div>
                <div class="listBox">
                    <ul id="moodEntriesList">
                        <li>
                            <span class="moodEmoji">😄</span>
                            <span class="moodTime">Feb 29, 2024 11:21 PM</span>
                        </li>
                        <li>
                            <span class="moodEmoji">😃</span>
                            <span class="moodTime">Feb 29, 2024 11:21 PM</span>
                        </li>
                        <li>
                            <span class="moodEmoji">😴</span>
                            <span class="moodTime">Feb 29, 2024 11:21 PM</span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>



    </section>


    <!-- Insert this line above script imports, required for electron node integration  -->
    <script>if (typeof module === 'object') { window.module = module; module = undefined; }</script>


    <!-- Bootstrap JS and dependencies -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.5.1/dist/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
    <!-- Code for other js files-->
    <script src="../js/myChart.js"></script>
    <script src="../js/renderer.js"></script>

    <!-- Insert this line after script imports -->
    <script>if (window.module) module = window.module;</script>

    <div id="preloader">
    </div>
    <script>
        const fs = require('fs');
        const path = require('path');
        function getTotalFocusDurationThisWeek(weekStartDate) {
            // Load the analytics file
            const analyticsFilePath = path.join(__dirname, '../database/focus_sessions.json');
            const analyticsData = JSON.parse(fs.readFileSync(analyticsFilePath));
            console.log(analyticsData);
            console.log(analyticsFilePath);
            // Calculate the start and end of the week
            const startDate = new Date(weekStartDate);
            const endDate = new Date(startDate);
            endDate.setDate(startDate.getDate() + 7);

            // Filter sessions for this week
            const thisWeekSessions = analyticsData.sessions.filter(session => {
                const sessionStartTime = new Date(session.start_time);
                return sessionStartTime >= startDate && sessionStartTime < endDate;
            });

            // Calculate total focus duration in minutes
            const totalFocusDuration = thisWeekSessions.reduce((total, session) => {
                const duration = session.focus_duration_minutes.split(':');
                return total + parseInt(duration[0]) * 60 + parseInt(duration[1]);
            }, 0);

            return totalFocusDuration;
        }
        function getTotalFocusDurationThisMonth(month) {
            // Load the analytics file
            const analyticsFilePath = path.join(__dirname, '../database/focus_sessions.json');
            const analyticsData = JSON.parse(fs.readFileSync(analyticsFilePath));

            // Filter sessions for the given month
            const monthSessions = analyticsData.sessions.filter(session => {
                const sessionStartTime = new Date(session.start_time);
                return sessionStartTime.getMonth() === month - 1; // JavaScript months are 0-based
            });

            // Calculate total focus duration in minutes
            const totalFocusDuration = monthSessions.reduce((total, session) => {
                const duration = session.focus_duration_minutes.split(':');
                return total + parseInt(duration[0]) * 60 + parseInt(duration[1]);
            }, 0);

            return totalFocusDuration;
        }
        // Function to get the number of distractions (apps closed) last week
        function getBlockedAppsCountLastWeek(weekStartDate) {
            // Load the analytics file
            const analyticsFilePath = path.join(__dirname, '../database/focus_sessions.json');
            const analyticsData = JSON.parse(fs.readFileSync(analyticsFilePath));

            // Calculate the start and end of the week
            const startDate = new Date(weekStartDate);
            const endDate = new Date(startDate);
            endDate.setDate(startDate.getDate() + 7);

            // Filter distractions for last week
            const lastWeekDistractions = analyticsData.sessions.filter(session => {
                const sessionStartTime = new Date(session.start_time);
                return sessionStartTime >= startDate && sessionStartTime < endDate && session.distractions > 0;
            });

            // Count the number of distractions
            const blockedAppsCount = lastWeekDistractions.reduce((count, session) => {
                return count + session.distractions;
            }, 0);

            return blockedAppsCount;
        }

        // Function to get the number of distractions (apps closed) this month
        function getBlockedAppsCountThisMonth(monthStartDate) {
            // Load the analytics file
            const analyticsFilePath = path.join(__dirname, '../database/focus_sessions.json');
            const analyticsData = JSON.parse(fs.readFileSync(analyticsFilePath));

            // Calculate the end of the month
            const endDate = new Date(monthStartDate);
            endDate.setMonth(endDate.getMonth() + 1);
            endDate.setDate(0); // Set to last day of the month

            // Filter distractions for this month
            const thisMonthDistractions = analyticsData.sessions.filter(session => {
                const sessionStartTime = new Date(session.start_time);
                return sessionStartTime >= monthStartDate && sessionStartTime <= endDate && session.distractions > 0;
            });

            // Count the number of distractions
            const blockedAppsCount = thisMonthDistractions.reduce((count, session) => {
                return count + session.distractions;
            }, 0);

            return blockedAppsCount;
        }


        // Function to update last week's focus duration
        function updateLastWeekFocusDuration() {
            const today = new Date();
            const lastWeekStartDate = new Date(today.getFullYear(), today.getMonth(), today.getDate() - 7);
            const lastWeekFocusDuration = getTotalFocusDurationThisWeek(lastWeekStartDate.toISOString().slice(0, 10));
            document.getElementById('lastWeekFocusDuration').textContent = lastWeekFocusDuration;
        }
        // Function to update this month's focus duration
        function updateThisMonthFocusDuration(month) {
            const thisMonthFocusDuration = getTotalFocusDurationThisMonth(month);
            document.getElementById('thisMonthFocusDuration').textContent = thisMonthFocusDuration;
        }

        // Function to update apps closed while focusing this week
        function updateAppsClosedThisWeek(weekStartDate) {
            const appsClosedThisWeek = getBlockedAppsCountLastWeek(weekStartDate);
            document.getElementById('appsClosedThisWeek').textContent = appsClosedThisWeek;
        }

        // Call the functions to update UI on page load
        const today = new Date();
        updateThisMonthFocusDuration(today.getMonth() + 1); // Month is 1-based
        updateAppsClosedThisWeek(today.toISOString().slice(0, 10));
        updateLastWeekFocusDuration();

        // Function to get the start date of the current week
        function getStartOfWeek(date) {
            const day = date.getDay();
            const diff = date.getDate() - day + (day === 0 ? -6 : 1); // Adjust when Sunday is the first day of the week
            return new Date(date.setDate(diff));
        }

        // Function to calculate betterment from last week
        function getBettermentFromLastWeek() {
            const today = new Date();
            const currentWeekStartDate = getStartOfWeek(today);
            const previousWeekStartDate = new Date(currentWeekStartDate);
            previousWeekStartDate.setDate(previousWeekStartDate.getDate() - 7);

            const currentWeekFocus = getTotalFocusDurationThisWeek(currentWeekStartDate.toISOString().slice(0, 10));
            const previousWeekFocus = getTotalFocusDurationThisWeek(previousWeekStartDate.toISOString().slice(0, 10));

            const improvement = currentWeekFocus - previousWeekFocus;
            const percentImprovement = ((improvement / previousWeekFocus) * 100).toFixed(2);
            return percentImprovement;
        }

        // Call the function to update UI on page load
        const betterment = getBettermentFromLastWeek();
        document.getElementById('bettermentFromLastWeek').textContent = betterment + "%";

        // Function to get the start date of the current month
        function getStartOfMonth(date) {
            return new Date(date.getFullYear(), date.getMonth(), 1);
        }

        // Function to update apps closed while focusing this month
        function updateAppsClosedThisMonth() {
            const today = new Date();
            const startOfMonth = getStartOfMonth(today);
            const appsClosedThisMonth = getBlockedAppsCountThisMonth(startOfMonth);
            document.getElementById('appsClosedThisMonth').textContent = appsClosedThisMonth;
        }



        // Call the function to update apps closed this month on page load
        updateAppsClosedThisMonth();

    </script>


    <!-- Pre loader Script
    <script>
    var loader = document.getElementById("preloader");
      window.addEventListener("load", function(){
       loader.style.display = "none";
     });
    </script> 
  -->
</body>

</html>